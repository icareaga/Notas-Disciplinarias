
<div class="admin-container">

  <!-- TÃ­tulo -->
  <h2 class="titulo">
    <span class="emoji" aria-hidden="true">ðŸ“‹</span>
    Casos disciplinarios de tu Ã¡rea
  </h2>

  <!-- Barra de acciones: Exportar + Filtros -->
  <div class="header-toolbar">
    <button class="btn-excel" (click)="exportarExcel()">
    Exportar Excel
    </button>

    <div class="filtros">
      <button
        class="filtro"
        [class.activo]="filtroEstado === 'TODOS'"
        (click)="setFiltro('TODOS')"
      >
        Todos <span class="badge">{{ conteos.todos }}</span>
      </button>

      <button
        class="filtro"
        [class.activo]="filtroEstado === 'SENALAR_PROBLEMA'"
        (click)="setFiltro('SENALAR_PROBLEMA')"
      >
        SeÃ±alar Problema <span class="badge">{{ conteos.senalarProblema }}</span>
      </button>

      <button
        class="filtro"
        [class.activo]="filtroEstado === 'DETERMINAR_CAUSA'"
        (click)="setFiltro('DETERMINAR_CAUSA')"
      >
        Determinar Causa <span class="badge">{{ conteos.determinarCausa }}</span>
      </button>

      <button
        class="filtro"
        [class.activo]="filtroEstado === 'PLAN_ACCION'"
        (click)="setFiltro('PLAN_ACCION')"
      >
        Plan de AcciÃ³n <span class="badge">{{ conteos.planAccion }}</span>
      </button>

      <button
        class="filtro"
        [class.activo]="filtroEstado === 'EVALUAR_RESULTADOS'"
        (click)="setFiltro('EVALUAR_RESULTADOS')"
      >
        Evaluar Resultados <span class="badge">{{ conteos.evaluarResultados }}</span>
      </button>

      <button
        class="filtro"
        [class.activo]="filtroEstado === 'NOTA_INCUMPLIMIENTO'"
        (click)="setFiltro('NOTA_INCUMPLIMIENTO')"
      >
        Nota Incumplimiento <span class="badge">{{ conteos.notaIncumplimiento }}</span>
      </button>

      <button
        class="filtro"
        [class.activo]="filtroEstado === 'ACTA_ADMINISTRATIVA'"
        (click)="setFiltro('ACTA_ADMINISTRATIVA')"
      >
        Acta Administrativa <span class="badge">{{ conteos.actaAdministrativa }}</span>
      </button>
    </div>
  </div>

  <!-- Buscador -->
  <input
    class="buscador"
    type="text"
    placeholder="Buscar por nombre del empleado..."
    [(ngModel)]="textoBusqueda"
    (input)="aplicarFiltros()"
  />

  <!-- Tabla -->
  <table class="tabla">
    <thead>
      <tr>
        <th class="col-id">ID</th>
        <th class="col-empleado">Empleado</th>
        <th class="col-motivo">Motivo</th>
        <th class="col-levantado">Levantado por</th>
        <th class="col-paso">Paso actual</th>
        <th class="col-estatus">Estatus</th>
        <th class="col-fecha">Fecha</th>
        <th class="col-acciones">Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let c of casosFiltrados">
        <td class="col-id id-caso"><strong>#{{ c.id }}</strong></td>
        <td class="col-empleado"><strong>{{ c.empleado }}</strong></td>
        <td class="col-motivo">{{ c.motivo }}</td>
        <td class="col-levantado">{{ c.levantadoPor }}</td>
        <td class="col-paso">
          <span class="badge" [ngClass]="'badge-' + c.estado.toLowerCase()">
            Paso {{ c.pasoActual }} Â· {{ c.pasoActualTexto }}
          </span>
        </td>
        <td class="col-estatus">
          <span class="badge-estatus" [ngClass]="c.estatusCaso === 1 ? 'activo' : 'cerrado'">
            <svg width="12" height="12" [attr.fill]="c.estatusCaso === 1 ? '#0f5132' : '#842029'" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>
            {{ c.estatusCaso === 1 ? 'Activo' : 'Cerrado' }}
          </span>
        </td>
        <td class="col-fecha">{{ c.fecha | date:'yyyy-MM-dd' }}</td>
        <td class="col-acciones">
          <button class="btn-ver" (click)="verCaso(c)" title="Ver detalle">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 32 32"><path d="M0 16q0.064 0.128 0.16 0.352t0.48 0.928 0.832 1.344 1.248 1.536 1.664 1.696 2.144 1.568 2.624 1.344 3.136 0.896 3.712 0.352 3.712-0.352 3.168-0.928 2.592-1.312 2.144-1.6 1.664-1.632 1.248-1.6 0.832-1.312 0.48-0.928l0.16-0.352q-0.032-0.128-0.16-0.352t-0.48-0.896-0.832-1.344-1.248-1.568-1.664-1.664-2.144-1.568-2.624-1.344-3.136-0.896-3.712-0.352-3.712 0.352-3.168 0.896-2.592 1.344-2.144 1.568-1.664 1.664-1.248 1.568-0.832 1.344-0.48 0.928zM10.016 16q0-2.464 1.728-4.224t4.256-1.76 4.256 1.76 1.76 4.224-1.76 4.256-4.256 1.76-4.256-1.76-1.728-4.256zM12 16q0 1.664 1.184 2.848t2.816 1.152 2.816-1.152 1.184-2.848-1.184-2.816-2.816-1.184-2.816 1.184l2.816 2.816h-4z"/></svg>
            Ver
          </button>
          <button class="btn-editar" (click)="editarCaso(c)" title="Editar caso">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
            Editar
          </button>
          <!-- <button class="btn-pdf" (click)="descargarPDF(c)">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 11V9h2v4h2l-3 3-3-3h2z"/></svg>
            PDF
          </button> -->
        </td>
      </tr>

      <tr *ngIf="casosFiltrados.length === 0">
        <td colspan="6" style="text-align:center; color:#666; padding: 20px;">
          No hay registros que coincidan con el filtro.
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Modal para ver detalle del caso -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><svg width="20" height="20" fill="white" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:8px;"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>Detalle del Caso #{{ casoSeleccionado?.id }}</h2>
      <button class="btn-cerrar" (click)="cerrarModal()">âœ•</button>
    </div>
    
    <div class="modal-body" *ngIf="casoSeleccionado">
      <div class="detalle-grid">
        <div class="detalle-item">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>Empleado:</label>
          <p>{{ casoSeleccionado.empleado }}</p>
        </div>
        
        <div class="detalle-item">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>Motivo:</label>
          <p>{{ casoSeleccionado.motivo }}</p>
        </div>
        
        <div class="detalle-item">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>Levantado por:</label>
          <p>{{ casoSeleccionado.levantadoPor }}</p>
        </div>
        
        <div class="detalle-item">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2z"/></svg>Fecha:</label>
          <p>{{ casoSeleccionado.fecha | date:'dd/MM/yyyy' }}</p>
        </div>
        
        <div class="detalle-item full-width">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>Paso actual:</label>
          <p>
            <span class="badge-grande" [ngClass]="'badge-' + casoSeleccionado.estado.toLowerCase()">
              Paso {{ casoSeleccionado.pasoActual }} Â· {{ casoSeleccionado.pasoActualTexto }}
            </span>
          </p>
        </div>

        <div class="detalle-item full-width" *ngIf="casoSeleccionado.descripcion">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>DescripciÃ³n:</label>
          <p class="texto-largo">{{ casoSeleccionado.descripcion }}</p>
        </div>

        <div class="detalle-item full-width" *ngIf="casoSeleccionado.impacto">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>Impacto:</label>
          <p class="texto-largo">{{ casoSeleccionado.impacto }}</p>
        </div>

        <div class="detalle-item full-width" *ngIf="casoSeleccionado.conducta">
          <label><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>Conducta:</label>
          <p class="texto-largo">{{ casoSeleccionado.conducta }}</p>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-secundario" (click)="cerrarModal()">Cerrar</button>
      <button class="btn-primario" (click)="editarCaso(casoSeleccionado!)">
        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" style="vertical-align:middle; margin-right:4px;"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
        Editar
      </button>
    </div>
  </div>
</div>
